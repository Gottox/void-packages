# Template file for 'k0s'
pkgname=k0s
version=0.9.1
revision=1
build_style=go
build_helper="qemu"
go_import_path=github.com/k0sproject/k0s
hostmakedepends="which golangci-lint"
depends="kubernetes containerd konnectivity-server etcd"
short_desc="Zero Friction Kubernetes"
maintainer="Enno Boland <gottox@voidlinux.org>"
license="Apache-2.0"
homepage="https://k0sproject.io/"
distfiles="https://github.com/k0sproject/$pkgname/archive/v$version.tar.gz"
checksum=d67c48a61370610554d15fc61e23ac6b819f73c9dcb2c4d19fdde494e3d55dc9
system_accounts="_k0s"
_k0s_homedir="/var/lib/k0s"
_k0s_descr="k0s server user"
make_dirs="/var/lib/k0s 0755 _k0s _k0s"
conf_files="
	/etc/k0s/k0s.conf
	/etc/default/*"
if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" k0s"
fi

pre_build() {
	# Make sure files are generated correctly before actually building
	make EMBEDDED_BINS_BUILDMODE=none generate-bindata
}

post_install() {
	vsv k0s
	vinstall ${FILESDIR}/k0s.default 644 /etc/default/ k0s

	vsv k0s-worker
	vinstall ${FILESDIR}/k0s-worker.default 644 /etc/default/ k0s-worker

	vmkdir etc/k0s

	vtargetrun $DESTDIR/usr/bin/k0s default-config > $DESTDIR/etc/k0s/k0s.conf
}
